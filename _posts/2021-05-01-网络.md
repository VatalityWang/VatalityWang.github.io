---
layout: post
title: 网络
categories: 学习
description: 随记
keywords: 网络
---

<head>
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
            inlineMath: [['$','$']]
            }
        });
    </script>
</head>

# 1 tcp

## 1.1 为什么不能两次握手

自我解释：客户端发出的请求可能因为忘了延迟，过了一段时间才到达服务器，服务器收到连接请求后，给客户端发送确认消息；此时客户端因为长时间未收到服务器的确认信息，认为服务器异常。则不会处理服务器很晚才到达的确认信息，也就不会再进行第三次握手。如果两次握手，服务器就认为已经建立连接了，实际是连接并未成功建立。

谢希仁版《计算机网络》：

“为了防止已失效的连接请求报文段突然又传送到了服务端，因而产生错误”。

防止旧复用链接的初始化导致问题。

SYN需要对方确认，要消耗序列号。ACK报文不需要对方确认不消耗序列号。

## 1.2 为什么要四次挥手

当服务端收到客户端的FIN数据包后，服务端数据可能还没有发送完，四次挥手可以防止这种情况发生。

## 1.3 往返时延(RTT)
RTT(Round-Trip Time): 往返时延。计网中的一个重要的性能指标，表示从发送端发送数据开始到发送端接收到来自数据接送端的确认(接收到数据后立即发送确认)，总共经历的时延。

组成：链路传播时间+末端系统的处理时间+路由器缓存中的排队和处理时间。前两部分作为一个TCP链接相对固定，路由器缓存中的排队和处理时间会随网络拥塞程度的变化而变化。

## 1.4 超时重传
   接收方每收到一个包就向发送方返回一个ACK,表示自己已经收到了这段数据。如果发送方一段时间内没有收到接收方返回的ACK就知道很可能是数据包丢失了，就重发该数据包，直到收到ACK为止。
	RTO(Retransmission Time Out):重传超时。往往大于2倍的RTT。每个数据包都有相应的计时其，一旦超过RTO而没收到ACK，就会重发该数据包。没收到ACK的数据包都会存在重传缓冲区里面，等到ACK后从缓冲区中删除。超时意味着拥塞，一旦发生这种情况，TCP重传对应数据段，还会降低当前数据的发送速率，因为TCP认为当前网络发生了拥塞。

tcp面试灵魂12问： https://segmentfault.com/a/1190000023565467

## 1.5 通过哪些方式保证可靠性？

* 应用数据被分割成TCP认为最合适发送的数据块；
* 确认机制：发送报文后，等待确认；
* 重发机制：没有收到确认，将重发数据段；
* 保持它首部和数据的校验和。确认数据的准确性；
* 排序，丢弃重复的，流量控制。

## 1.6 TCP与UDP的区别

* TCP面向连接，UDP面向无连接；
* TCP面向报文，UDP面向字节流；
* TCP提供可靠传输服务（数据顺序，正确性），UDP传输不可靠；
* TCP传输协议慢，UDP协议传输速度快；
* TCP协议对系统资源要求多(头部开销大)，UDP协议要求少。



# 2 如何在UDP的基础上实现一个相对可靠的传输协议？



# 3 MSL(Maximum segment lifetime)
最大分段寿命是一个TCP 分段可以存在于互联网系统中的最大时间。它被任意地定义为两分钟长。


# 4 LAN(Local  Area Network)
局域网：将小区域各种通信设备互连在一起的通信网络。
典型特性：

 * 高速率（0.1M~100Mbps）
* 短距离 (0.1km~25km)
* 低误码率（$10^{-8}~10^{-11}$）



# 5 网络各个层的设备
* 应用层：网关，是最复杂的网络互连设备，仅用于两个高层协议不同的网络互连。网关的结构也和路由器类似，不同的是互连层。网关既可以用于广域网互连，也可以用于局域网互连 。
* 传输层：网关
* 网络层(路由选择，存储转发)：路由器，交换机。
* 数据链路层：交换机，网桥。
* 物理层：集线器：纯硬件设备，主要用来连接计算机等网络终端。中继器：在比特级别对网络进行再生和重定时，从而使得它们能够传输更远的距离。

# 6 TCP/IP协议栈(各种协议)

## 6.1 应用层

http,https;

ftp(文件传输协议);

Telnet: 远程登录协议，用于[互联网](https://zh.wikipedia.org/wiki/網際網路)及[局域网](https://zh.wikipedia.org/wiki/局域网)中，使用[虚拟终端](https://zh.wikipedia.org/wiki/虛擬終端機)的形式，提供双向、以文字字符串为主的[命令行接口](https://zh.wikipedia.org/wiki/命令列介面)交互功能。缺点：传统Telnet会话所传输的资料并未[加密](https://zh.wikipedia.org/wiki/加密)，账号和密码等敏感资料容易会被窃听，因此很多服务器都会屏蔽Telnet服务，改用更安全的[SSH](https://zh.wikipedia.org/wiki/Secure_Shell)。

相关邮件协议：SMTP，IMAP，POP，MIME；

NTP,DHCP;

DNS 域名解析系统，基于UDP；

SSH:安全外壳协议，基于TCP，使用22号端口。

## 6.2 传输层

tcp,udp;



## 6.3 网络层

* ICMP

  Internet Control Message Protocol 因特网控制报文协议。它是[TCP/IP协议簇](https://baike.baidu.com/item/TCP%2FIP协议簇)的一个子协议，用于在IP[主机](https://baike.baidu.com/item/主机/455151)、[路由](https://baike.baidu.com/item/路由)器之间传递控制消息。控制消息是指[网络通](https://baike.baidu.com/item/网络通)不通、[主机](https://baike.baidu.com/item/主机/455151)是否可达、[路由](https://baike.baidu.com/item/路由/363497)是否可用等网络本身的消息。这些控制消息虽然并不传输用户数据，但是对于用户数据的传递起着重要的作用。ICMP实际上是IP的一个组成部分，必须由每个IP模块实现。ping 和 tracert是两个常用网络管理命令，ping 用来测试网络可达性，tracert 用来显示到达目的主机的路径。ping和 tracert 都利用 ICMP 协议来实现网络功能，它们是把网络协议应用到日常网络管理的典型实例；

* IP ：Internet 协议。通过路由选择将下一条IP封装后交给接口层。IP数据报是无连接服务。 

* ARP：地址解析协议，主要根据ip地址找到对应的MAC硬件地址；

* RARP：作用与ARP相反；

* IGMP：网路群组管理协议。



## 6.4 数据链路层

WI-FI(IEEE 802.11)；PPP(Point to Point Protocol)为点对点连接上传输多协议数据包提供了一种标准方法。



# 7 ping 过程

* 主机广播ARP请求，查询被ping主机的mac地址；
* 被ping主机应答ARP请求，向发起ping请求的主机单向应答自己的MAC地址；
* 知道了MAC地址后，开始真正地进行ping请求；
* 两台电脑由此开始相互应答。

> 关于ARP缓存

* 为了防止ARP过期，结束后重新更新下ARP缓存，保证下次请求能去往正确的路径(ARP过期会出现一次错误，从而影响测试准确性)。
* ping命令的响应时间是根据请求包和响应包的时间戳计算出来的，一次ARP过程也是消耗时间的 。提前更新ARP缓存可以节省ping的ARP时间。

# 8 关于重定向报文

* 由路由器产生；
* 为主机而不是路由器使用。

# 9 TCP中的异常情况(断连)

![2021-08-16_095915.png](/images/blog/2021-08-16_095915.png)

![image-20210816100720402](/images/blog/image-20210816100720402.png)

# 10 tcp中的四个定时器

![image-20210816101941934](/images/blog/image-20210816101941934.png)

